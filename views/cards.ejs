<%
locals.title = "Cards - Giffon";
bodyClasses.push("page-cards");

var hasCardClass = user.user_has_card ? "has-card-some" : "has-card-none";
%>
<%- include('head'); -%>

<div class="container <%=hasCardClass%>">
    <h1>Your payment method</h1>
    <% 
        if (user.user_has_card) {
            var card = user.stripe_customer.default_source;
    %>
        <div>
            <p><span><%=card.brand%></span> **** **** **** <span><%=card.last4%></span><span class="card-id d-none"><%=card.id%></span></p>
            <a id="replace-card" href="#replace-card">replace card</a>
        </div>
    <%
        }
    %>
    <form action="/cards" method="POST" id="payment-form" enctype="application/x-www-form-urlencoded" class="needs-validation" novalidate>
        <div class="form-row">
            <label>
                Credit or debit card
            </label>
            <div id="card-element">
                <!-- A Stripe Element will be inserted here. -->
            </div>
    
            <!-- Used to display Element errors. -->
            <div id="card-errors"  class="alert alert-danger" role="alert"></div>
        </div>
        <div>
            <p>You may see a temporary authorization for $1, which will not be actually charged.</p>
            <p>You will only be charged when the Giffon campaign you pledged ends.</p>
        </div>
        <div class="form-group">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="checkbox-terms" required>
                <label class="form-check-label" for="checkbox-terms">
                    Agree to <a href="/terms" target="_blank">terms and conditions</a>
                </label>
                <div class="invalid-feedback">
                    You must agree before submitting.
                </div>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
    <script>
        // Example starter JavaScript for disabling form submissions if there are invalid fields
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                // Fetch all the forms we want to apply custom Bootstrap validation styles to
                var forms = document.getElementsByClassName('needs-validation');
                // Loop over them and prevent submission
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
    </script>
</div>

<%- include('foot'); -%>